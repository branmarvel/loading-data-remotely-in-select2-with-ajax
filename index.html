<!doctype html>
<html>

<head>
    <title>Loading data remotely in Select2 with AJAX</title>

    <meta charset="UTF-8">
    <!-- jQuery -->
    <script src='jquery-3.0.0.js' type='text/javascript'></script>

    <!-- select2 css -->
    <link href='select2/dist/css/select2.min.css' rel='stylesheet' type='text/css'>

    <!-- select2 script -->
    <script src='select2/dist/js/select2.min.js'></script>
</head>

<body>

    <h1>select con ajax</h1>
    <select id='selUser' style='width: 200px;'>
        <option value='0'>- Search user -</option>
    </select>

    <script>

        $(document).on('select2:select', () => {
            document.querySelector('.select2-search__field').focus();//hace focus en el buscador a darle select
        });
        // $("#state").select2({
        //     closeOnSelect: false,

        // });


        $(document).ready(function () {

            $("#selUser").select2({
                ajax: {
                    url: "getData.php",
                    type: "post",
                    dataType: 'json',
                    delay: 250,
                    data: function (params) {
                        return {
                            searchTerm: params.term // search term
                        };
                    },
                    processResults: function (response) {
                        console.log(response)
                        return {
                            results: response
                        };
                    },
                    cache: true
                }
            });
        });

        $('#continent').select2({
            language: {
                noResults: function (term) {
                    console.log(event.target.value);
                    typed = event.target.value;
                    if (typed.length > 4) {
                        continentVal = prompt("Sorry ! Not found any continent do you want to add new continent");
                        console.log(' === ' + continentVal);
                        if (continentVal != "") {
                            console.log('Here we go ' + event.target.value + continentVal);
                            // Create a DOM Option and pre-select by default
                            var newOption = new Option(continentVal, continentVal, true, true);
                            // Append it to the select
                            $('#continent').append(newOption).trigger('change');
                        }
                    }
                }
            }
        });

    </script>


    <br><br><br><br>

    <h1>select con input para agregar</h1>
    <select id="state" class="js-example-basic-single" type="text" style="width:90%">
        <option value="AL">Alabama</option>
        <option value="WY">Wyoming</option>
        <option value="ew">Wyoming</option>
        <option value="sd">Wyoming</option>
        <option value="WY">Wyoming</option>
        <option value="WY">Wyoming</option>
    </select>
    <br>
    <br>
    <input id="new-state" type="text" />
    <button type="button" id="btn-add-state">Set state value</button>

    <script>
        $(document).ready(function () {
            $("#state").select2({
                closeOnSelect: false,//evita q se cierre al seleccionar



                tags: true
            });

            $("#btn-add-state").on("click", function () {
                var newStateVal = $("#new-state").val();
                // Set the value, creating a new option if necessary
                if ($("#state").find("option[value=" + newStateVal + "]").length) {
                    $("#state").val(newStateVal).trigger("change");
                } else {
                    // Create the DOM option that is pre-selected by default
                    var newState = new Option(newStateVal, newStateVal, true, true);
                    // Append it to the select
                    $("#state").append(newState).trigger('change');
                }
            });
        });
        $(document).on("select2:open", () => {
            document.querySelector(".select2-container--open .select2-search__field").focus()
        })
    </script>
</body>

</html>
